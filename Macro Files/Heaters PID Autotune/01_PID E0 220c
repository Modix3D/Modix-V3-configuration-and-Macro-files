; Generated by Modix - Version 3.4.5 Macro B

M104 T0 S0 								; turn off heater
if heat.heaters[0].current > 45			; check for heater temp
	M291 S3 R"Attention!" P"Temperature is above 45c. Printer will wait until the temperature has dropped to below 45."
	M106 P0 S255 						; turn on fan to help cool
else
	G4 P0								; do nothing

while heat.heaters[0].current > 45 		; wait for the heater to be under 30 degrees
	G4 S2								; loop wait 2 seconds
	
M106 P0 S0 								; turn fan off before tuning

G28										; home all
G1 X200 Y200 F3000						; move to center area of the bed
G1 Z2 									; move nozzle down

M300 S666 P666 							; beep
M291 S3 R"Attention!" P"During auto tuning there is minimal protection against heating faults. Therefore you should not leave the printer unattended"
M570 H0 P120 T50						; Extend the heater H0 fault timeout to 120 seconds for testing
G4 S1									; wait 1 second
M303 H0 T0 P1 S220 F1.0					; Start the PID tune at 220c, fan at 100%

G4 S1									; wait 1 second						
while heat.heaters[0].state = "tuning"	; wait for the PID tune to be completed
     G4 S1								; loop wait 1 second
M291 S3 R"The results of the PID tune have been automatically saved" P"You can view the results of the PID tune in the PID_tune_E0.g file"

echo "The results of the PID tune have been automatically saved." 
echo "You can view the results of the PID tune in the PID_tune_E0.g file"
echo >"0:/sys/PID_tune_E0.g" "M307 H0 R"^{heat.heaters[0].model.heatingRate}, "K"^{heat.heaters[0].model.coolingRate}^":"^{heat.heaters[0].model.fanCoolingRate}, "D"^{heat.heaters[0].model.deadTime}, "E"^{heat.heaters[0].model.coolingExp}
echo >>"0:/sys/PID_tune_E0.g" "M307 H0 B0 S1.0 V"^{heat.heaters[0].model.standardVoltage}

M570 H0 P5 T15							; set heater fault detection back to default
G1 Z10									; move nozzle up
M84										; disable stepper motors


