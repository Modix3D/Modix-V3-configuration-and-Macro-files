; Macro file for Duet WiFi
; Generated by Modix - Version 3.4.2 Macro A

G28										; home all
G1 X200 Y200 F3000						; move to center area of the bed
G1 Z2 									; move nozzle down

M300 S666 P666 							; beep
M291 S3 R"Attention!" P"During auto tuning there is minimal protection against heating faults. Therefore you should not leave the printer unattended"
M570 H1 P120 T50						; Extend the heater H1 fault timeout to 120 seconds for testing
G4 S1									; wait 1 second
M303 H1 T1 P1 S270 F1.0					; Start the PID tune at 270c, fan at 100%

G4 S1									; wait 1 second						
while heat.heaters[1].state = "tuning"	; wait for the PID tune to be completed
     G4 S1								; loop wait 1 second
M291 S3 R"The results of the PID tune have been automatically saved" P"You can view the results of the PID tune in the PID_tune_E1.g file"

echo "The results of the PID tune have been automatically saved." 
echo "You can view the results of the PID tune in the PID_tune_E1.g file"

echo >"0:/sys/PID_tune_E1.g" "M307 H0 R"^{heat.heaters[1].model.heatingRate}, "K"^{heat.heaters[1].model.coolingRate}^":"^{heat.heaters[1].model.fanCoolingRate}, "D"^{heat.heaters[1].model.deadTime}, "E"^{heat.heaters[1].model.coolingExp}
echo >>"0:/sys/PID_tune_E1.g" "M307 H0 B0 S1.0 V"^{heat.heaters[1].model.standardVoltage}

G1 Z10									; move nozzle up
M84										; disable stepper motors